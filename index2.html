<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <title>口罩地圖</title>
</head>

<body>
    <section class="container-fluid">
        <article class="row vh-100">
            <!-- 選單列 -->
            <menu class="col-md-2 m-0 bg-info">
                <!-- 縣市選擇 -->
                <div class="my-3 row align-items-center fs-5">
                    <label for="cityName" class="col-sm-4 col-form-label text-center fw-bold">縣市</label>
                    <div class="col-sm-8">
                        <select class="form-select text-center" aria-label="Default select example" id="cityName">
                            <option selected>----請選擇縣市----</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                    </div>
                </div>
                <!-- 鄉鎮地區 -->
                <div class="my-3 row align-items-center fs-5">
                    <label for="townName" class="col-sm-4 col-form-label text-center fw-bold">鄉鎮區</label>
                    <div class="col-sm-8">
                        <select class="form-select text-center" aria-label="Default select example" id="townName">
                            <option selected>----請選擇縣市----</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                    </div>
                </div>
                <!-- 藥局資料 -->
                <ul class="list-group h-100">
                    <li class="list-group-item">
                        <h4 class="fw-bold">XXX藥局</h4>
                        <p>地址: XXXX</p>
                        <p>電話: XXXXXX</p>
                        <p>成人口罩: <span class="text-danger h4">oo</span>個 | 兒童口罩: <span class="text-danger h4">oo</span>個
                        </p>
                    </li>

                </ul>

            </menu>


            <main class="col-md-10 m-0 bg-secondary">

            </main>
        </article>

    </section>


    <!-- 外部 js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
    <script src="script/module/citydata.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <!-- mine js -->
    <script>
        var selectCity = ''; //紀錄選取的縣市名稱
        var selectTown = ''; //紀錄選取的鄉鎮區名稱
        var selectCounty = []; //紀錄選取的縣市所包含的鄉鎮(多個)
        var maskData = []; //紀錄健保局的所有藥局資料
        $(function () {
            //載入健保局資料
            $.ajax({
                type: "GET",
                url: "script/points.json",
                dataType: "json",
                async: false,
                success: function (data) {
                    maskData = data.features;
                },
                error: function () {
                    alert("讀取健保局的所有藥局資料失敗!");
                }
            });
            console.log(maskData);
            console.log(cityData);
            $("#cityName").empty();
            $("#cityName").append('<option selected>--先選擇縣市--</option>');
            //綁定渲染縣市名稱選單
            cityData.forEach(function (item) {
                console.log(item.CityName);
                var strHTML = '<option value="' + item.CityName + '">' + item.CityName + '</option>';
                $("#cityName").append(strHTML);
            });
            //監聽縣市名稱選單
            $("#cityName").change(function () {
                console.log($(this).val());
                selectCity = $(this).val();
                cityData.forEach(function (item) {
                    if (item.CityName == selectCity) {
                        selectCounty = item.AreaList;
                    }
                });
                console.log(selectCounty);
                $("#townName").empty();
                $("#townName").append('<option selected>--先選擇鄉鎮區--</option>');
                selectCounty.forEach(function (item) {
                    console.log(item.AreaName);
                    var strHTML = '<option value="' + item.AreaName + '">' + item.AreaName + '</option>';
                    $("#townName").append(strHTML);
                });
            });
            //監聽鄉鎮區名稱選單
            $("#townName").change(function () {
                selectTown = $(this).val();
                console.log(selectCity);
                console.log(selectTown);
                var townList = [];//收集所選擇的鄉鎮區裡面的所有藥局
                maskData.forEach(function (item) {
                    if (item.properties.county == selectCity && item.properties.town == selectTown) {
                        townList.push(item)
                    }
                });
                console.log(townList);
                $("#regionList").empty();
                townList.forEach(function (item) {
                    var strHTML = '<li class="list-group-item"><h2>' + item.properties.name + '</h2><h4>住址: ' + item.properties.address + '</h4><h4>電話: ' + item.properties.phone + '</h4><h5>成人口罩: <span class="text-danger h4">' + item.properties.mask_adult + '</span>個 | 兒童口罩: <span class="text-danger h4">' + item.properties.mask_child + '</span>個</h5></li>';
                    $("#regionList").append(strHTML);
                });
            });
        });
    </script>

</body>

</html>